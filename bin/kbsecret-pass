#!/usr/bin/env ruby
# frozen_string_literal: true

require "kbsecret"
require "clipboard"

include KBSecret

cmd = CLI.new do
  slop do |o|
    o.banner = <<~EOS
      Usage:
        kbsecret pass [--session <session>] [--clipboard] <record>
    EOS

    o.string "-s", "--session", "the session to search in", default: :default
    o.bool "-c", "--clipboard", "dump the password in the clipboard"
  end

  dreck do
    string :label
  end

  ensure_session!
end

session = Session.new label: cmd.opts[:session]
label   = cmd.args[:label]
record  = session[label]

CLI.die "No such record." unless record
CLI.die "'#{record}' is not a login record." unless record.type == :login

if cmd.opts.clipboard?
  Clipboard.copy record.password
else
  puts record.password
end
