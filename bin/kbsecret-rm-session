#!/usr/bin/env ruby
# frozen_string_literal: true

require "kbsecret"

cmd = KBSecret::CLI.new do
  slop do |o|
    o.banner = <<~EOS
      Deconfigure (and optionally delete) a session.

      Usage:
        kbsecret rm-session --delete <label>

      Example:
        kbsecret rm-session old-keys
        kbsecret rm-session --delete even-older-keys
    EOS

    o.bool "-d", "--delete", "unlink the session in addition to deconfiguration"
  end

  dreck do
    string :label
  end
end

label = cmd.args[:label]

session = KBSecret::CLI.ensure_session label
session.unlink! if cmd.opts.delete?

KBSecret::Config.deconfigure_session label
