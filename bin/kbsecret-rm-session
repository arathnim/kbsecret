#!/usr/bin/env ruby
# frozen_string_literal: true

require "kbsecret"

include KBSecret

cmd = CLI.new do
  slop do |o|
    o.banner = <<~EOS
      Deconfigure (and optionally delete) a session.

      Usage:
        kbsecret rm-session [--delete] <session>

      Example:
        kbsecret rm-session old-keys
        kbsecret rm-session --delete even-older-keys
    EOS

    o.bool "-d", "--delete", "unlink the session in addition to deconfiguration"
  end

  dreck do
    string :session
  end

  ensure_session! :argument
end

label = cmd.args[:session]

session = Session.new label: label
session.unlink! if cmd.opts.delete?

Config.deconfigure_session label
